!function(e){var t={};function r(n){if(t[n])return t[n].exports;var u=t[n]={i:n,l:!1,exports:{}};return e[n].call(u.exports,u,u.exports,r),u.l=!0,u.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=10)}([function(e,t){e.exports=require("express")},function(e,t){e.exports=require("mongoose")},function(e,t){e.exports=require("babel-runtime/regenerator")},function(e,t){e.exports=require("babel-runtime/helpers/asyncToGenerator")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,u=r(1),a=(n=u)&&n.__esModule?n:{default:n};t.default=a.default.model("User",(0,u.Schema)({phone:{trim:!0,type:String,maxlength:10,required:!0},name:{trim:!0,type:String,maxlength:100},verified:{trim:!0,type:Boolean,required:!0,default:!1},shops:[{trim:!0,ref:"Shop",type:u.Schema.Types.ObjectId}],createdAt:{type:Date,required:!0,default:Date.now}})),e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,u=r(1),a=(n=u)&&n.__esModule?n:{default:n};t.default=a.default.model("Code",(0,u.Schema)({user:{trim:!0,ref:"User",required:!0,type:u.Schema.Types.ObjectId},code:{trim:!0,type:String,maxlength:10,required:!0},createdAt:{trim:!0,type:Date,required:!0,default:Date.now,expires:86400}})),e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s(r(24)),u=s(r(25)),a=s(r(7)),o=s(r(26));function s(e){return e&&e.__esModule?e:{default:e}}t.default=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e,r,s){var d=!0,f=!1,i=void 0;try{for(var l,c=(0,a.default)(t);!(d=(l=c.next()).done);d=!0){var p=l.value;if(!(p in e.body))return r.json({type:20});e.body[p]=(0,o.default)(e.body[p]),"object"===(0,u.default)(e.body[p])&&(e.body[p]=(0,n.default)(e.body[p]))}}catch(e){f=!0,i=e}finally{try{!d&&c.return&&c.return()}finally{if(f)throw i}}return s()}},e.exports=t.default},function(e,t){e.exports=require("babel-runtime/core-js/get-iterator")},function(e,t){e.exports=require("graphql")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,u=r(27),a=(n=u)&&n.__esModule?n:{default:n};t.default=function(){return(0,a.default)({integer:!0,min:1e5,max:999999})},e.exports=t.default},function(e,t,r){"use strict";var n=v(r(7));r(11);var u=v(r(12)),a=v(r(13)),o=v(r(0)),s=v(r(1)),d=v(r(14)),f=v(r(15)),i=v(r(16)),l=v(r(17)),c=v(r(18)),p=v(r(19)),x=v(r(21)),b=r(33);function v(e){return e&&e.__esModule?e:{default:e}}s.default.Promise=global.Promise,s.default.connect(b.db),s.default.connection.on("error",function(){a.default.exit(1)}),s.default.connection.on("disconnected",function(){a.default.exit(1)});var y=(0,o.default)();"development"===a.default.env.NODE_ENV&&y.use((0,u.default)("short")),y.use(d.default.urlencoded({extended:!1})),y.use(d.default.json({limit:1e7})),y.use((0,l.default)());var _=(0,c.default)(i.default);y.use((0,i.default)({secret:b.sessionKey,resave:!0,cookie:{maxAge:864e5},saveUninitialized:!1,store:new _({url:a.default.env.DB||b.db})})),y.use("/graphql",function(e,t){return(0,f.default)({schema:p.default,graphiql:!0,context:{req:e,res:t}})(e,t)});var m=!0,h=!1,j=void 0;try{for(var q,g=(0,n.default)(x.default);!(m=(q=g.next()).done);m=!0){var M=q.value;y.use(M)}}catch(e){h=!0,j=e}finally{try{!m&&g.return&&g.return()}finally{if(h)throw j}}y.listen(b.port,function(){console.log("The server is running!!!")})},function(e,t){e.exports=require("babel-polyfill")},function(e,t){e.exports=require("morgan")},function(e,t){e.exports=require("process")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("express-graphql")},function(e,t){e.exports=require("express-session")},function(e,t){e.exports=require("cookie-parser")},function(e,t){e.exports=require("connect-mongo")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,u=r(8),a=r(20),o=(n=a)&&n.__esModule?n:{default:n};t.default=new u.GraphQLSchema({query:o.default}),e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(8);t.default=new n.GraphQLObjectType({name:"Query",fields:{}}),e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,u=r(22),a=(n=u)&&n.__esModule?n:{default:n};t.default=[a.default],e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(r(23)),u=o(r(28)),a=o(r(31));function o(e){return e&&e.__esModule?e:{default:e}}t.default=[n.default,u.default,a.default],e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(2)),u=i(r(3)),a=r(0),o=i(r(4)),s=i(r(5)),d=i(r(6)),f=i(r(9));function i(e){return e&&e.__esModule?e:{default:e}}var l,c=new a.Router,p=(0,d.default)("phone");c.post("/resend",p,(l=(0,u.default)(n.default.mark(function e(t,r){var u,a,d;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.default.findOne({phone:t.body.phone});case 2:if(u=e.sent){e.next=5;break}return e.abrupt("return",r.json({type:2,text:0}));case 5:return e.next=7,s.default.findOne({user:u._id});case 7:return(a=e.sent)&&a.remove(),d=new s.default({user:u._id,code:(0,f.default)()}),e.next=12,d.save();case 12:return e.abrupt("return",r.json({type:0}));case 13:case"end":return e.stop()}},e,void 0)})),function(e,t){return l.apply(this,arguments)})),t.default=c,e.exports=t.default},function(e,t){e.exports=require("babel-runtime/core-js/json/stringify")},function(e,t){e.exports=require("babel-runtime/helpers/typeof")},function(e,t){e.exports=require("mongo-sanitize")},function(e,t){e.exports=require("random-number")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=l(r(2)),u=l(r(3)),a=r(0),o=l(r(4)),s=l(r(5)),d=l(r(6)),f=l(r(29)),i=l(r(9));function l(e){return e&&e.__esModule?e:{default:e}}var c,p=new a.Router,x=(0,d.default)("phone");p.post("/enter",x,(c=(0,u.default)(n.default.mark(function e(t,r){var u,a,d,l;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((0,f.default)(t.body.phone)){e.next=2;break}return e.abrupt("return",r.json({type:2,text:30}));case 2:return u=!1,e.next=5,o.default.findOne({phone:t.body.phone});case 5:if(a=e.sent,d=(0,i.default)(),a){e.next=19;break}return u=!0,a=new o.default({phone:t.body.phone}),e.prev=10,e.next=13,a.save();case 13:e.next=19;break;case 15:return e.prev=15,e.t0=e.catch(10),console.log(e.t0),e.abrupt("return",r.json({type:2,text:0}));case 19:return e.next=21,s.default.findOne({user:a._id});case 21:if(l=e.sent){e.next=32;break}return l=new s.default({user:a._id,code:d}),e.prev=24,e.next=27,l.save();case 27:e.next=32;break;case 29:return e.prev=29,e.t1=e.catch(24),e.abrupt("return",r.json({type:2,text:1}));case 32:return e.abrupt("return",r.json({type:0,isUserNew:u}));case 33:case"end":return e.stop()}},e,void 0,[[10,15],[24,29]])})),function(e,t){return c.apply(this,arguments)})),t.default=p,e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,u=r(30),a=(n=u)&&n.__esModule?n:{default:n};t.default=function(e){return!(0,a.default)(e)&&10===e.toString().length},e.exports=t.default},function(e,t){e.exports=require("babel-runtime/core-js/number/is-nan")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(2)),u=i(r(3)),a=r(0),o=i(r(32)),s=i(r(4)),d=i(r(5)),f=i(r(6));function i(e){return e&&e.__esModule?e:{default:e}}var l,c=new a.Router,p=(0,f.default)("phone","code");c.post("/login",p,(l=(0,u.default)(n.default.mark(function e(t,r){var u,a,f;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.default.findOne({phone:t.body.phone});case 2:if(u=e.sent){e.next=5;break}return e.abrupt("return",r.json({type:2,text:0}));case 5:return e.next=7,d.default.findOne({user:u._id});case 7:if(a=e.sent){e.next=10;break}return e.abrupt("return",r.json({type:2,text:1}));case 10:return e.next=12,o.default.findOne({user:u._id});case 12:if(f=e.sent){e.next=17;break}return f=new o.default({user:u._id}),e.next=17,f.save();case 17:if(f.attempts+=1,f.save(),!(f.attempts>10)){e.next=21;break}return e.abrupt("return",r.json({type:2,text:2}));case 21:if(t.body.code!==a.phone){e.next=24;break}return a.remove(),e.abrupt("return",r.json({type:0}));case 24:return e.abrupt("return",r.json({type:2,text:3}));case 25:case"end":return e.stop()}},e,void 0)})),function(e,t){return l.apply(this,arguments)})),t.default=c,e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,u=r(1),a=(n=u)&&n.__esModule?n:{default:n};t.default=a.default.model("Attempt",(0,u.Schema)({user:{trim:!0,ref:"User",required:!0,type:u.Schema.Types.ObjectId},attempts:{trim:!0,default:0,type:Number,required:!0},createdAt:{trim:!0,type:Date,required:!0,default:Date.now,expires:86400}})),e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={port:"8080",db:process.env.DB||"mongodb://0.0.0.0/hyper",sessionKey:process.env.SECRET_KEY||"QIFE564%?sKb]JTqeN0Az.9vH4ahjM1l~",hashKey:process.env.HASH_KEY||"*wtt_a4pv[ZZSd,+8C8V"},e.exports=t.default}]);